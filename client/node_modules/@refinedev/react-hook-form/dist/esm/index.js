import{useEffect as G}from"react";import{useForm as L}from"react-hook-form";import{useForm as I,useWarnAboutChange as q}from"@refinedev/core";var U=({refineCoreProps:c,warnWhenUnsavedChanges:u,...m}={})=>{let{warnWhenUnsavedChanges:R,setWarnWhen:l}=q(),V=u!=null?u:R,F=I({...c}),{queryResult:r,onFinish:e,formLoading:C}=F,o=L({...m}),{watch:s,reset:b,getValues:f,handleSubmit:t}=o;G(()=>{var a;if(typeof(r==null?void 0:r.data)<"u"){let p={},x=Object.keys(f());Object.entries(((a=r==null?void 0:r.data)==null?void 0:a.data)||{}).forEach(([y,n])=>{x.includes(y)&&(p[y]=n)}),b(p)}},[r==null?void 0:r.data]),G(()=>{let a=s((p,{type:x})=>{x==="change"&&d(p)});return()=>a.unsubscribe()},[s]);let d=a=>(V&&l(!0),a),E=(a,p)=>async x=>(l(!1),await t(a,p)(x));return{...o,handleSubmit:E,refineCore:F,saveButtonProps:{disabled:C,onClick:a=>{E(e,()=>!1)(a)}}}};import{useEffect as ee,useState as te}from"react";var re=({stepsProps:c,...u}={})=>{let{defaultStep:m=0,isBackValidate:R=!1}=c!=null?c:{},[l,V]=te(m),F=U({...u}),{trigger:r,getValues:e,reset:C,formState:{dirtyFields:o},refineCore:{queryResult:s}}=F;ee(()=>{var t;if(s!=null&&s.data){let d={},E=Object.keys(e());Object.entries((t=s==null?void 0:s.data)==null?void 0:t.data).forEach(([T,a])=>{E.includes(T)&&(o[T]?d[T]=e(T):d[T]=a)}),C(d,{keepDirty:!0,keepDirtyValues:!0})}},[s==null?void 0:s.data,l]);let b=t=>{let d=t;t<0&&(d=0),V(d)};return{...F,steps:{currentStep:l,gotoStep:async t=>{if(t===l)return;if(t<l&&!R){b(t);return}await r()&&b(t)}}}};import{useCallback as N}from"react";import{useGo as oe,useModal as se,useParsed as ae,useResource as ne,userFriendlyResourceName as ie,useTranslate as le,useWarnAboutChange as de}from"@refinedev/core";import H from"react";var ue=({modalProps:c,refineCoreProps:u,syncWithLocation:m,...R}={})=>{var k,w,j,P,W,M,$;let l=H.useRef(!1),V=le(),{resource:F,action:r}=u!=null?u:{},{resource:e,action:C}=ne(F),o=ae(),s=oe(),b=(k=r!=null?r:C)!=null?k:"",f=typeof m=="object"&&m.syncId,t=typeof m=="object"&&"key"in m?m.key:e&&b&&m?`modal-${(w=e==null?void 0:e.identifier)!=null?w:e==null?void 0:e.name}-${b}`:void 0,{defaultVisible:d=!1,autoSubmitClose:E=!0,autoResetForm:T=!0}=c!=null?c:{},a=U({refineCoreProps:u,...R}),{reset:p,refineCore:{onFinish:x,id:y,setId:n},saveButtonProps:Y,handleSubmit:z}=a,{visible:S,show:B,close:g}=se({defaultVisible:d});H.useEffect(()=>{var i,K,O,A;if(l.current===!1&&t){let h=(K=(i=o==null?void 0:o.params)==null?void 0:i[t])==null?void 0:K.open;if(typeof h=="boolean"?h&&B():typeof h=="string"&&h==="true"&&B(),f){let Q=(A=(O=o==null?void 0:o.params)==null?void 0:O[t])==null?void 0:A.id;Q&&(n==null||n(Q))}l.current=!0}},[t,o,f,n]),H.useEffect(()=>{var i;l.current===!0&&(S&&t?s({query:{[t]:{...(i=o==null?void 0:o.params)==null?void 0:i[t],open:!0,...f&&y&&{id:y}}},options:{keepQuery:!0},type:"replace"}):t&&!S&&s({query:{[t]:void 0},options:{keepQuery:!0},type:"replace"}))},[y,S,B,t,f]);let D=async i=>{await x(i),E&&g(),T&&p()},{warnWhen:v,setWarnWhen:J}=de(),X=N(()=>{if(v)if(window.confirm(V("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))J(!1);else return;n==null||n(void 0),g()},[v]),Z=N(i=>{n==null||n(i),B()},[]),_=V(`${e==null?void 0:e.name}.titles.${r}`,void 0,`${ie(`${r} ${($=(M=(W=(j=e==null?void 0:e.meta)==null?void 0:j.label)!=null?W:(P=e==null?void 0:e.options)==null?void 0:P.label)!=null?M:e==null?void 0:e.label)!=null?$:e==null?void 0:e.name}`,"singular")}`);return{modal:{submit:D,close:X,show:Z,visible:S,title:_},...a,saveButtonProps:{...Y,onClick:i=>z(D)(i)}}};export{U as useForm,ue as useModalForm,re as useStepsForm};
//# sourceMappingURL=index.js.map