import A from"react";import{useResource as He}from"@refinedev/core";var Ze=/(image|photo|avatar|url|logo|cover|thumbnail|icon)/i,K=(e,r)=>{let n=["name","label","title","count","content","username","nickname","login","firstName","lastName","url"];Ze.test(e)&&n.unshift("url");let t=n.find(s=>s in r&&!!r[s]);if(t)return t==="firstName"&&"lastName"in r?["firstName","lastName"]:t};import{pickNotDeprecated as Me}from"@refinedev/core";function z(e,r,n){if(r)return r;let t=n==null?void 0:n.find(i=>i.name===e),s=Me(t==null?void 0:t.meta,t==null?void 0:t.options);return s!=null&&s.dataProviderName?s.dataProviderName:"default"}var N=e=>{var r;return(r=e==null?void 0:e.options)==null?void 0:r.dataProviderName};var O=e=>{let r=[...e].filter(Boolean).sort((n,t)=>(t.priority||0)-(n.priority||0))[0];return r||null};import br from"prettier/standalone";import Ar from"prettier/parser-typescript";var U=e=>e.replace(/ {2,}/g," ").replace(/\n{2,}/g,`
`);var V=/(-id|-ids|_id|_ids|Id|Ids|ID|IDs)(\[\])?$/,ce=(e,r)=>{let n=V.test(e),t=typeof r=="string"||typeof r=="number",s=Array.isArray(r)&&r.every(i=>typeof i=="string"||typeof i=="number");return n&&t||n&&s?{key:e,relation:!0,multiple:!!s,type:"relation",priority:1}:!1};var I=e=>e.replace(V,"");var S=e=>I(e).replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/-/g," ").split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ");var B=e=>e.replace(/export\s+(const|let|var|type|interface|function|class)\s+(\w+)\s*(=|:)\s*/g,"$1 $2 = ").split(`
`).filter(s=>!s.trim().startsWith("export default")).join(`
`);var pe=/import(?:(?:(?:[ \n\t]+([^ *\n\t\{\},]+)[ \n\t]*(?:,|[ \n\t]+))?([ \n\t]*\{(?:[ \n\t]*[^ \n\t"'\{\}]+[ \n\t]*,?)+\})?[ \n\t]*)|[ \n\t]*\*[ \n\t]*as[ \n\t]+([^ \n\t\{\}]+)[ \n\t]+)from[ \n\t]*(?:['"])([^'"\n]+)(?:['"])(?:;?)/g,qe=/import[ \n\t](?:['"])([^'"\n]+)(?:['"])(?:;?)/g,Ye=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,H=(e,r={})=>{let n=e.matchAll(pe),t=new Set;for(let s of n){let[,i,a,p,c]=s;if(c in r){let m=r[c];if(c==="react")continue;i&&t.add(`const { default: ${i} } = ${m};`),a&&t.add(`const${a.replace(Ye,"$1: $3$4")} = ${m};`),p&&t.add(`const ${p} = ${m};`)}}return U(`
    ${Array.from(t).join(`
`)}
    ${e.replace(pe,"").replace(qe,"")}
    `)};import E from"pluralize";var W=(e,r)=>e?r.find(t=>{let s=I(e.key);return t.name===s||t.name===(E.isPlural(s)?s:E.plural(s))||t.name===(E.isSingular(s)?s:E.singular(s))}):void 0;import Ge from"pluralize";var j=(e,r,n="Inferred")=>{let t=e.replace(/[^a-zA-Z0-9]/g," "),s=Ge.singular(t),a=S(s).replace(/ /g,"")||n,p=r.charAt(0).toUpperCase()+r.slice(1);return/^[a-zA-Z]/.test(a)?`${a}${p}`:`${p}${a}`};var Je=e=>e?Array.isArray(e)?e.join(""):typeof e=="string"?e:typeof e=="object"||typeof e=="function"?e.toString():typeof e=="number"?String(e):typeof e=="boolean"&&e?"true":e:"",me=(e,...r)=>e.reduce((t,s,i)=>`${t}${s}${Je(r[i])}`,"").trim();var Z=(e,r)=>`
    ${e!=null?e:""}
    
    render(typeof ${r} !== "undefined" ? <${r} /> : <></>);
    `;var M=e=>e==null?void 0:e.replace(/(\/\* hidden-start \*\/)(.|\n)*?(\/\* hidden-end \*\/)/g,"");var Qe=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/,_=e=>Qe.test(e);function q(e,r,n){let t=`${e}`;return r&&(t+="?.",_(r)?t+=r:t+=`['${r}']`),n&&(t+="?.",_(n)?t+=n:t+=`['${n}']`),t}function Xe(e,r,n){return(n!=null?n:[]).map(s=>q(e,r,s))}var le=(e,r,n,t=' + " " + ')=>Array.isArray(n)?t?Xe(e,r,n).join(t):q(e,r,n[0]):q(e,r,n),Y=(e,r,n)=>{let t=e;return r&&(t+=`.${r}`),n&&(Array.isArray(n)?t+=`.${n[0]}`:t+=`.${n}`),t},fe=e=>Array.isArray(e.accessor)||e.multiple?`accessorKey: "${e.key}"`:e.accessor?`accessorKey: "${Y(e.key,void 0,e.accessor)}"`:`accessorKey: "${e.key}"`;var ue=e=>{let r=e.reduce((t,[s,i,a])=>(t[i]||(t[i]=[]),t[i].includes(s)||(a?t[i].push([s,!0]):t[i].push(s)),t),{});return Object.entries(r).map(([t,s])=>{let i=s.find(m=>Array.isArray(m)&&m[1]),a=s.filter(m=>typeof m=="string"),p=i?`${i[0]}`:"",c=a.length?`{ ${a.join(", ")} }`:"";return`import ${p}${p&&c?", ":""}${c} from "${t}";`})};import de from"pluralize";var T=(e="")=>de.isSingular(e)?e:de.singular(e);import ge from"pluralize";var v=(e="")=>ge.isPlural(e)?e:ge.plural(e);var er=/^id$/i,ye=e=>er.test(e);var Ie=e=>e.relationInfer&&e.relationInfer.accessor?Array.isArray(e.relationInfer.accessor)?`optionLabel: "${e.relationInfer.accessor[0]}",`:e.relationInfer.accessor!=="title"?`optionLabel: "${e.relationInfer.accessor}",`:"":"";var he=e=>{};var xe=(e,r="")=>{if(Number.isInteger(Number(e)))return r.charAt(0).toLowerCase()+r.slice(1)+e;let t=e.replace(/^\d+/,"").replace(/[^a-zA-Z0-9]/g,"-"),s=S(t).replace(/ /g,"");return`${s.charAt(0).toLowerCase()+s.slice(1)}${r.charAt(0).toUpperCase()+r.slice(1)}`};var be=e=>{let r=(n,t,s,i=r)=>{let a=e.map(c=>c(n,t,s,i));return O(a)};return r};var Fe=e=>(n,t,s,i,a)=>e.reduce((p,c)=>c(p,t,s,i,a),n);var Ae=(e,r,n,t)=>{let s=Array.isArray(r),i=Array.isArray(r)&&r.every(a=>typeof a=="string"||typeof a=="number");if(s){if(!i){let p=t(e,r[0],n,t);return p?{...p,key:e,multiple:!0,priority:1}:!1}let a=t(e,r[0],n,t)||{type:"string"};return{key:e,multiple:!0,priority:1,type:a==null?void 0:a.type}}return!1};var ke=(e,r)=>typeof r=="boolean"?{key:e,type:"boolean"}:!1;import Ce from"dayjs";var rr=/(_at|_on|At|On|AT|ON)(\[\])?$/,tr=["/",":","-","."],Re=(e,r)=>{let n=rr.test(e)&&Ce(r).isValid(),t=typeof r=="string"&&Ce(r).isValid();return typeof r=="string"&&tr.some(i=>r.includes(i))&&(n||t)?{key:e,type:"date",priority:1}:!1};var nr=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,$e=(e,r)=>typeof r=="string"&&nr.test(r)?{key:e,type:"email",priority:1}:!1;var or=/\.(gif|jpe?g|tiff?|png|webp|bmp|svg)$/i,we=(e,r)=>typeof r=="string"&&or.test(r)?{key:e,type:"image",priority:2}:!1;var Te=(e,r)=>typeof r>"u"||r===null?null:!1;var ve=(e,r)=>{let n=typeof r=="string"&&r.length>0,t=!isNaN(r);return n&&t||typeof r=="number"?{key:e,type:"number"}:!1};var sr=/id$/i,Ne=(e,r,n,t)=>{let s=r!==null,i=!Array.isArray(r);if(s&&i&&typeof r=="object"){if(Object.keys(r).length===1&&sr.test(Object.keys(r)[0]))return{key:e,type:"relation",relation:!0,accessor:"id",priority:1};let c=K(e,r);if((c?c.length>0:!1)&&c){let g=c&&Array.isArray(c)?c[0]:c,f=t(g,r[g],r,t);if(f){let l=Array.isArray(c)?c.map(u=>f.accessor?`${u}.${Array.isArray(f.accessor)?f.accessor[0]:f.accessor}`:u):f.accessor?Array.isArray(f.accessor)?`${c}.${f.accessor[0]}`:`${c}.${f.accessor}`:c;return{...f,fieldable:!0,key:e,accessor:l,priority:1}}}return{key:e,fieldable:!1,type:"object",priority:1}}return!1};var Se=(e,r)=>typeof r=="string"&&r.length>100?{key:e,type:"richtext",priority:1}:!1;var Pe=(e,r)=>typeof r=="string"?{key:e,type:"text"}:!1;var ir=/^(https?|ftp):\/\/(-\.)?([^\s/?\.#-]+\.?)+(\/[^\s]*)?$/i,Le=(e,r)=>typeof r=="string"&&ir.test(r)?{key:e,type:"url",priority:1}:!1;var De=[Ae,ke,Re,$e,we,Te,ve,Ne,ce,Se,Pe,Le];var Ke=(e,r,n,t)=>e.map(i=>{if(!i.relation&&(i.type==="text"||i.type==="richtext"||i.type==="number")&&!i.canRelation){let a=/^[a-z0-9-]+$/,p=l=>a.test(`${l}`),c=i.key.toLowerCase()!=="id";return!(!i.accessor||typeof i.accessor=="string")||!c?i:(i.multiple?t[i.key]:[t[i.key]]).every(l=>p(i.accessor?l[i.accessor]:l))?{...i,canRelation:!0}:i}return i});var ar=/(image|photo|avatar|cover|thumbnail|icon)/i,Ee=e=>e.map(n=>n.type==="url"&&ar.test(n.key)?{...n,type:"image"}:n);var je=(e,r)=>e.map(t=>{let s=W(t,r);return s?{...t,relation:!0,type:"relation",resource:s}:t});var _e=(e,r,n,t,s)=>e.map(a=>{if(a.relation&&a.type==="relation"&&!a.resource){let p=a.accessor?t[a.key][a.accessor]:t[a.key],c=s(a.key,p,t,s);if(c&&c.type!=="relation")return{...a,fieldable:!0,relation:!1,type:c.type,canRelation:!0}}return a});var ze=[Ee,je,_e,Ke];import mn,{useEffect as ln}from"react";import un,{defaultProps as dn}from"prism-react-renderer";import yn from"prism-react-renderer/themes/vsDark";import b from"react";import*as cr from"@refinedev/core";import{LivePreview as pr,LiveProvider as mr}from"@aliemir/react-live";var Oe=[["react","React",b],["@refinedev/core","RefineCore",cr]],G=b.createContext({}),J=({fetchError:e,code:r,additionalScope:n,errorComponent:t})=>{var p;let s=(p=r&&B(H(r,[...Oe,...n!=null?n:[]].reduce((c,[m,g,f,l])=>l?c:{...c,[m]:g},{}))))!=null?p:"",i=b.useMemo(()=>({React:b,...b,...[...Oe,...n!=null?n:[]].reduce((c,[m,g,f])=>({...c,[g]:f}),{})}),[n]),a=b.useMemo(()=>()=>{let{error:m}=b.useContext(G);return t?b.createElement(t,{error:m?`<p>An error occured while rendering the generated component.You can check the generated code from the below "Show Code" button and fix the error manually.</p>
                                    <p>If you think this is a bug, please report the issue at <a target="_blank" rel="noopener noreferrer" href="https://github.com/refinedev/refine/issues">https://github.com/refinedev/refine/issues</a></p>
                                    <p>Exception:</p>
                                    <code>${m}</code>`:typeof e=="string"?e:e?`<p>Something went wrong while fetching the resource data.</p>
                                    <p>To learn more about the Inferencer, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`:void 0}):null},[t,e]);return b.createElement(mr,{Context:G,code:s,scope:i,noInline:!0},!e&&b.createElement(pr,{Context:G}),b.createElement(a,null))};import P from"react";import{useDataProvider as lr,useResource as fr}from"@refinedev/core";var Ue=(e,r,n)=>{let{resource:t,id:s,resources:i}=fr(r),a=n!=null?n:s,p=lr(),[c,m]=P.useState(void 0),[g,f]=P.useState(void 0),[l,u]=P.useState(!0),[k,o]=P.useState(!1),C=P.useCallback(async F=>{var h,w;let y=(h=N(t))!=null?h:z(t==null?void 0:t.name,void 0,i),d=p(y);o(!0),m(void 0);try{if((e==="list"||e==="create")&&t){let x=(w=(await d.getList({resource:t==null?void 0:t.name})).data)==null?void 0:w[0];x||m(`<p>No records/data found for resource "${t==null?void 0:t.name}".</p>
                            <p>Please check your data provider and resource.</p>
                            <p>For more info, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`),f(x),setTimeout(()=>{o(!1)},500)}if((e==="edit"||e==="show")&&F&&t){let x=(await d.getOne({resource:t==null?void 0:t.name,id:F})).data;x||m(`<p>No records/data found for resource "${t==null?void 0:t.name}".</p>
                            <p>Please check your data provider and resource.</p>
                            <p>For more info, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`),f(x),setTimeout(()=>{o(!1)},500)}}catch(R){console.warn("An error occured while fetching the resource data. Please check the error message below:",R),m(`<p>Something went wrong while fetching the resource data.</p>
                    <p>Please check your data provider and API for resource "${t==null?void 0:t.name}".</p>
                    <p>For more info, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`),setTimeout(()=>{o(!1)},500)}},[e,p,t,i]);return P.useEffect(()=>{u(!1),!k&&!g&&C(a)},[C,a]),{data:g,loading:k,initial:l,error:c}};import D from"react";import{useDataProvider as ur}from"@refinedev/core";import{get as Ve}from"lodash";var Be=({record:e,fields:r,infer:n})=>{let t=ur(),[s,i]=D.useState([]),[a,p]=D.useState(!0),[c,m]=D.useState(!1),g=D.useCallback(async f=>{console.groupCollapsed("@refinedev/inferencer is trying to detect relations");let l=[];m(!0);try{let u=f.map(async o=>{if(o&&(o.relation||o.canRelation)&&e){let C=N(o.resource),F=t(C),y=Array.isArray(o.accessor)?void 0:o.multiple?e[o.key].map(d=>o.accessor?Ve(d,o.accessor):d)[0]:o.accessor?Ve(e[o.key],o.accessor):e[o.key];if(y&&o.resource)try{let{data:d}=await F.getOne({resource:o.resource.name,id:y});l.push({status:"success",resource:o.resource.name,field:o.key});let h=n("__",d,{},n);return{...o,relationInfer:h}}catch{return l.push({status:"error",resource:o.resource.name,field:o.key}),{...o,relationInfer:null}}if(y){let d,h;try{let{data:x}=await F.getOne({resource:v(I(o.key)),id:y});l.push({status:"success",resource:v(I(o.key)),field:o.key}),d=x,h=!0}catch{l.push({status:"error",resource:v(I(o.key)),field:o.key});try{let{data:$}=await F.getOne({resource:T(I(o.key)),id:y});l.push({status:"success",resource:T(I(o.key)),field:o.key}),d=$,h=!1}catch{return l.push({status:"error",resource:T(I(o.key)),field:o.key}),{...o,relationInfer:null}}}let w=n("__",d,{},n),R=I(o.key);return{...o,relation:!0,type:"relation",resource:{name:h?v(R):T(R)},fieldable:!1,canRelation:void 0,relationInfer:w}}return{...o,relationInfer:null}}return o}),k=await Promise.all(u);i(k.filter(o=>o)),setTimeout(()=>{m(!1)},500)}catch{setTimeout(()=>{m(!1)},500)}setTimeout(()=>{console.log(`Tried to detect relations with ${l.length} attempts and succeeded with ${l.filter(u=>u.status==="success").length} attempts.`),console.groupEnd()},500)},[t,e]);return D.useEffect(()=>{p(!1),!c&&r&&r.length>0&&s.length===0&&g(r)},[g,c,r,g]),{fields:s,loading:c,initial:a}};var dr=({type:e,additionalScope:r=[],customElements:n=[],fieldTransformers:t=[],renderer:s,loadingComponent:i,errorComponent:a,codeViewerComponent:p})=>{let c=be([...De,...n]),m=Fe([...ze,...t]),g=({resourceName:l,fieldTransformer:u,id:k})=>{var X,ee,re,te,ne,oe;let{resource:o,resources:C}=He(l),{resource:F}=He(),{data:y,loading:d,initial:h,error:w}=Ue(e,l!=null?l:o==null?void 0:o.name,k),R=A.useMemo(()=>{if(y){let We=Object.keys(y).map(L=>{let se=y[L];return c(L,se,y,c)}).filter(Boolean);if(o){let L=m(We,C,o,y,c);return u?L.flatMap(ie=>{let ae=u(ie);return ae?[ae]:[]}):L}return[]}return[]},[y,C,o,u]),{fields:x,loading:$}=Be({record:y,fields:R,infer:c}),Q=A.useMemo(()=>!d&&!$&&!h&&o?s({resource:o,resources:C,fields:x,infer:c,isCustomPage:o.name!==(F==null?void 0:F.name),id:k}):"",[o,C,x,d,$]);return A.createElement(A.Fragment,null,i&&(d||$)&&A.createElement(i,null),!d&&!$&&A.createElement(A.Fragment,null,A.createElement(J,{fetchError:!d&&w?w:!d&&!h&&!y,code:Z(Q,j((oe=(ne=(te=(re=(X=o==null?void 0:o.meta)==null?void 0:X.label)!=null?re:(ee=o==null?void 0:o.options)==null?void 0:ee.label)!=null?te:o==null?void 0:o.label)!=null?ne:o==null?void 0:o.name)!=null?oe:"Resource",e)),errorComponent:a,additionalScope:r}),p&&A.createElement(p,{code:M(Q),loading:d||$})))};return({name:l,resource:u,fieldTransformer:k,id:o})=>A.createElement(g,{fieldTransformer:k,resourceName:u!=null?u:l,key:u!=null?u:l,id:o})};export{le as accessor,j as componentName,dr as createInferencer,N as dataProviderFromResource,Y as dotAccessor,fe as getAccessorKey,K as getFieldableKeys,Ie as getOptionLabel,xe as getVariableName,ye as isIDKey,me as jsx,he as noOp,S as prettyString,ue as printImports,I as removeRelationSuffix,_ as shouldDotAccess,v as toPlural,T as toSingular};
//# sourceMappingURL=index.js.map